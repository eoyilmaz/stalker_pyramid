{% extends "base.jinja2" %}

{# BREADCRUMBS #}
{% block breadcrumbs %}
    {% set page_title='Permissions' %}
    {% include 'breadcrumb/breadcrumbs.jinja2' %}
{% endblock breadcrumbs %}

{# SIDEBAR #}
{% block sidebar %}
    {% include 'sidebar.jinja2' %}
{% endblock sidebar %}

{# PAGE-CONTENT #}
{% block page_content %}
    {% set page_title='Permissions' %}

    {% include 'page_header.jinja2' %}

    <div class="row-fluid">
        <div class="widget-box span8">
            <div class="widget-header widget-header-blue widget-header-flat">
                <h4 class="lighter">Permissions</h4>
                {% if has_permission('Update_Group') %}
                    <div class="widget-toolbar">
                        <label>
                            <small class="green">
                                <b>Editable</b>
                            </small>

                            <input id="skip-validation" type="checkbox"
                                   class="ace ace-switch ace-switch-4"/>
                            <span class="lbl"></span>
                        </label>
                    </div>
                {% endif %}
            </div>

            <div class="widget-body">
                <div class="widget-main">
                    <div class="row-fluid">

                        <table id="permission"
                               class="table table-striped table-bordered table-hover dataTable">
                            <thead>
                            <tr>
                                <th>Action Name</th>
                                <th>Create</th>
                                <th>Read</th>
                                <th>Update</th>
                                <th>Delete</th>
                                <th>List</th>
                            </tr>
                            </thead>
                            <tbody>


                            </tbody>
                        </table>


                    </div>
                    <div class="space-10"></div>
                    <div class="row-fluid">
                        <button  id='permissions_submit_button' class='btn btn-success pull-right'>
                            <i class="icon-edit"></i> Update
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {#        {% include 'group/list/list_group_permissions.jinja2' %}#}



    {#    </div>#}

{% endblock page_content %}

{% block extrascripts %}


    {% raw %}
    <script id="tmpl_permission" type="text/x-dot-template">
        <tr>
            <td>{{=it.label}}</td>
            <td>
                <label>
                    <input id="Create_{{=it.label }}"
                           name="form-field-checkbox" type="checkbox"
                    {{=it.disabled }}
                    {{=it.Create }}
                    class="ace ace-checkbox-2">
                    <span class="lbl"></span>
                </label>
            </td>
            <td>
                <label>
                    <input id="Read_{{=it.label }}" name="form-field-checkbox"
                           type="checkbox"
                    {{=it.disabled }}
                    {{=it.Read }}
                    class="ace ace-checkbox-2">
                    <span class="lbl"></span>
                </label>
            </td>
            <td>
                <label>
                    <input id="Update_{{=it.label }}"
                           name="form-field-checkbox" type="checkbox"
                    {{=it.disabled }}
                    {{=it.Update }}
                    class="ace ace-checkbox-2">
                    <span class="lbl"></span>
                </label>
            </td>
            <td>
                <label>
                    <input id="Delete_{{=it.label }}"
                           name="form-field-checkbox" type="checkbox"
                    {{=it.disabled }}
                    {{=it.Delete }}
                    class="ace ace-checkbox-2">
                    <span class="lbl"></span>
                </label>
            </td>
            <td>
                <label>
                    <input id="List_{{=it.label }}" name="form-field-checkbox"
                           type="checkbox"
                    {{=it.disabled }}
                    {{=it.List }}
                    class="ace ace-checkbox-2">
                    <span class="lbl"></span>
                </label>
            </td>

        </tr>
    </script>
    {% endraw %}

    <script type="text/javascript">

        $(document).ready(function () {

            $.getJSON('/groups/{{ entity.id }}/permissions/').then(function (data) {
                var permission_template = doT.template($('#tmpl_permission').html());
                var table_body = $('#permission>tbody');
                for (var i = 0; i < data.length; i++) {
                    data[i].disabled = 'disabled'
                    table_body.append(permission_template(data[i]));
                }
            });

            $('.ace-checkbox-2').attr('disabled', false);

            {% if has_permission('Update_Group') %}
                $('#skip-validation').removeAttr('checked').on('click', function () {
                    console.log('#skip-validation')
                    if (this.checked) {
                        $('.ace-checkbox-2').attr('disabled', false);
                    } else {
                        $('.ace-checkbox-2').attr('disabled', true);
                    }
                });
            {% endif %}
        });

        $(document).ready(function () {
            var submit_button = $('#permissions_submit_button');
            submit_button.on('click', function (e) {
                e.stopPropagation();
                e.preventDefault();

                submit_button.button('loading');

                $.post('',
                    time_log_form.serialize() + '&' + $.param({ 'start': start.toUTCString(), 'end': end.toUTCString() })
                ).done(function () {
                    window.location.assign('{{ came_from }}');
                }).fail(function(jqXHR) {
                    bootbox.alert(jqXHR.responseText);
                    submit_button.button('reset');
                });
            }
        });
    </script>

{% endblock extrascripts %}
