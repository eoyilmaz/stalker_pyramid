<div class="row-fluid">

    <form id='group_form'
          class='form-horizontal'
          role='form'
          method="post"
          action="{{ request.route_url('create_group') }}">


        {#        Thumbnail #}
        <div class="control-group">
            <label class="span2 control-label"
                   for="group_thumbnail">Thumbnail</label>

            <div class="span3">
                <input id="group_thumbnail"
                       name='thumbnail'
                       type="file"
                       class="form-control"
                        >
            </div>
        </div>

        {#        Name #}
        <div class="control-group">
            <label class="span2 control-label"
                   for="group_name">Name</label>

            <div class="span6">
                <input id="group_name"
                       name='name'
                       type="text"
                       class="form-control"
                       placeholder="Name"
                       required>
            </div>
        </div>

        {#        Description #}
        <div class='control-group'>
            <label class='span2 control-label' for='group_description'>Description</label>

            <div class='span6'>
                <textarea id="group_description"
                          name='description'
                          class="autosize-transition span12"
                          style="overflow: hidden;
                                     word-wrap: break-word;
                                     resize: horizontal;
                                     height: 50px;"
                        >{% if mode=='update' %}
                    {{ entity.description }}{% endif %}</textarea>
            </div>
        </div>
    </form>

    <form id='group_permission_create_form'
          class='form-horizontal'
          role='form'
          method='post'>
{% set mode='Create' %}
        {% set address=request.route_url('get_group_permissions', id=-1) %}
        {% include 'group/list/list_group_permissions.jinja2' %}


    </form>

</div>

<script src='{{ request.static_url("stalker_pyramid:static/ace/js/bootstrap-wysiwyg.min.js") }}'></script>

<script type="text/javascript">

    var permissions_loaded = function () {

        $('.ace-checkbox-2').attr('disabled', false);

    }

    function init_dialog() {
        console.debug('starting to initialize group dialog!!!');

        $('#dialog_template_label').find('span').remove();
        $('#dialog_template_label').append('<span>New Group</span>')

        //$('#dialog_template').attr('style', "width:700px; height:800px");

        $('.ace-checkbox-2').on('click', function () {

            console.log(this.id + ' ' + this.checked)
            if (!this.checked) {
                this.value = '';
                return;
            }
            this.value = 'Allow';
        });

        {# Submit Button #}
        $('#dialog_template_submit_button').on('click', function (e) {
            e.stopPropagation();
            e.preventDefault();

            // disable the submit_button
            var submit_button = $(this);
            submit_button.button('loading');


            var group_form = $('#group_form');
            var group_permission_form = $('#group_permission_create_form')

            $.post(
                            "{{ request.route_url('create_group') }}",
                            group_permission_form.serialize() + '&' +
                                    $.param({ 'name': $('#group_name').val(), 'description': $('#group_name').val()})
                    ).done(function () {

                        window.location.assign('{{ came_from }}');

                    }).fail(function (jqXHR) {

                        bootbox.alert(jqXHR.responseText);
                        submit_button.button('reset');

                    });
        });


        console.debug('finished initializing the user dialog!')
    }
</script>

<script type="text/javascript">

    function destruct_dialog() {
        $('.ace-checkbox-2').attr('disabled', true);
        $('#group_form').unbind();
        {#        $('#user_name').unbind();#}
        {#        $('#user_login').unbind();#}
        {#        $('#user_email').unbind();#}
        {#        $('#user_password').unbind();#}
        {#        $('#user_password2').unbind();#}
        {#        $('#dialog_template_submit_button').unbind();#}
        {##}
        $('#dialog_template').data('modal', null);

    }
</script>

