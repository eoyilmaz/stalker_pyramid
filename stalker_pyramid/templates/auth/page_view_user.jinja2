{# Stalker Pyramid a Web Base Production Asset Management System
 Copyright (C) 2009-2013 Erkan Ozgur Yilmaz

 This file is part of Stalker Pyramid.

 This library is free software; you can redistribute it and/or
 modify it under the terms of the GNU Lesser General Public
 License as published by the Free Software Foundation;
 version 2.1 of the License.

 This library is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 Lesser General Public License for more details.

 You should have received a copy of the GNU Lesser General Public
 License along with this library; if not, write to the Free Software
 Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
#}
<div style="margin-top: 0" id='user_border_container'>
    {#  <div id='user_summary'>#}
    {# Summary View #}
    {#  </div>#}
    <div id='data_tab_container'>
        <div id='tasks_content_pane'></div>
        <div id='time_logs_content_pane'></div>
        <div id='projects_content_pane'></div>
        <div id='tickets_content_pane'></div>
        <div id='departments_content_pane'></div>
    </div>
</div>

<script type='text/javascript'>
    require([
        'dijit/layout/BorderContainer',
        'dijit/layout/TabContainer',
        'dojox/layout/ContentPane',

        'dojo/domReady!'
    ], function (BorderContainer, TabContainer, ContentPane) {

        var user_BorderContainer = new BorderContainer({
            id: 'user_border_container',
            region: 'center',
            orientation: 'vertical',
            splitter: true,
            resizable: false,
            style: 'width:100%; height:100%; margin:0;'
        }, 'user_border_container');

        var summary_content_pane = new ContentPane({
            title: 'Summarize',
            href: 'users/{{ user.id }}/summarize',
            region: 'top',
            style: 'width:100%; height:150px; padding: 0; background-color: #eeeeee;',
            splitter: true

        });

        user_BorderContainer.addChild(summary_content_pane);

        // **********************************************************************
        // Bottom Part - Complex Data View
        var user_related_data_tab_container = new TabContainer({
            title: 'Tab',
            region: 'center',
            style: 'width: 100%; height: 100%; background-color: #45b8cc;'

        }, 'data_tab_container');


        {% if has_permission('List_Task') or logged_in_user.id==user.id %}
            var tasks_content_pane = new ContentPane({
                id: 'tasks_content_pane',
                title: 'Tasks',
                href: 'users/{{ user.id }}/tasks/list',
                default_href: 'users/{{ user.id }}/tasks/list',
                style: ' padding: 0; margin:0;'
            }, 'tasks_content_pane');
            user_related_data_tab_container.addChild(tasks_content_pane);
        {% endif %}


        {% if has_permission('List_TimeLog') or logged_in_user.id==user.id %}
            var time_logs_content_pane = new ContentPane({
                id: 'timelogs_content_pane',
                title: 'Time Logs',
                href: 'users/{{ user.id }}/time_logs/list',
                default_href: 'users/{{ user.id }}/time_logs/list',
                style: 'padding: 0; margin:0;'
            });
            user_related_data_tab_container.addChild(time_logs_content_pane);
        {% endif %}


        {% if has_permission('List_Project') or logged_in_user.id==user.id %}
            var projects_content_pane = new ContentPane({
                id: 'projects_content_pane',
                title: 'Projects',
                href: 'users/{{ user.id }}/projects/list',
                default_href: 'users/{{ user.id }}/projects/list',
                style: ' padding: 0; margin:0;'
            });
            user_related_data_tab_container.addChild(projects_content_pane);
        {% endif %}


        {% if has_permission('List_Department') or logged_in_user.id==user.id %}
            var departments_content_pane = new ContentPane({
                id: 'departments_content_pane',
                title: 'Departments',
                href: 'users/{{ user.id }}/departments/list',
                default_href: 'users/{{ user.id }}/departments/list',
                style: ' padding: 0; margin:0;'
            });
            user_related_data_tab_container.addChild(departments_content_pane);
        {% endif %}


        {% if has_permission('List_Group') or logged_in_user.id==user.id %}
            var groups_content_pane = new ContentPane({
                id: 'permissions_content_pane',
                title: 'Permissions',
                href: 'users/{{ user.id }}/groups/list',
                default_href: 'users/{{ user.id }}/groups/list',
                style: ' padding: 0; margin:0;'
            });
            user_related_data_tab_container.addChild(groups_content_pane);
        {% endif %}


        {% if has_permission('List_Ticket') or logged_in_user.id==user.id %}
            var tickets_content_pane = new ContentPane({
                id: 'tickets_content_pane',
                title: 'Tickets',
                href: 'users/{{ user.id }}/tickets/list',
                default_href: 'users/{{ user.id }}/tickets/list',
                style: ' padding: 0; margin:0;'
            });
            user_related_data_tab_container.addChild(tickets_content_pane);
        {% endif %}


        {% if has_permission('List_Vacation')  or logged_in_user.id==user.id %}
            var vacations_content_pane = new ContentPane({
                title: 'Vacations',
                href: 'users/{{ user.id }}/vacations/list',
                default_href: 'users/{{ user.id }}/vacations/list',
                style: 'padding: 0; margin:0;'
            });
            user_related_data_tab_container.addChild(vacations_content_pane);
        {% endif %}

        user_BorderContainer.addChild(user_related_data_tab_container);
        user_related_data_tab_container.startup();
        user_BorderContainer.startup();

{#        user_related_data_tab_container.watch(#}
{#            "selectedChildWidget",#}
{#            function (name, oval, nval) {#}
{#                console.debug("selected child changed from ", nval.title, " to ", nval.href);#}
{#                oval.set('href', '');#}
{#                oval.refresh();#}

{#                nval.set('href', nval.default_href);#}
{#                nval.refresh();#}
        
{#            }#}
{#        );#}
    });
</script>
