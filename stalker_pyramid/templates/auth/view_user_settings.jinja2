{% extends "base.jinja2" %}



{% block pre_header %}
    <link rel="stylesheet"
          href='{{ request.static_url("stalker_pyramid:static/ace/css/jquery-ui-1.10.3.custom.min.css") }}'/>
    <link rel="stylesheet"
          href='{{ request.static_url("stalker_pyramid:static/ace/css/jquery.gritter.css") }}'/>
    <link rel="stylesheet"
          href='{{ request.static_url("stalker_pyramid:static/ace/css/chosen.min.css") }}'/>
    <link rel="stylesheet"
          href='{{ request.static_url("stalker_pyramid:static/ace/css/datepicker.css") }}'/>
    <link rel="stylesheet"
          href='{{ request.static_url("stalker_pyramid:static/ace/css/bootstrap-timepicker.css") }}'/>
    <link rel="stylesheet"
          href='{{ request.static_url("stalker_pyramid:static/ace/css/daterangepicker.css") }}'/>
    <link rel="stylesheet"
          href='{{ request.static_url("stalker_pyramid:static/ace/css/colorpicker.css") }}'/>
    <link rel="stylesheet"
          href='{{ request.static_url("stalker_pyramid:static/ace/css/bootstrap-editable.css") }}'/>

{% endblock pre_header %}

{% block sidebar %}
    {% include 'auth/user_sidebar.jinja2' %}
{% endblock sidebar %}

{% block page_content %}
    {% set user=entity %}
    {% set page_title='Settings' %}
    {% include 'page_header.jinja2' %}
    <!--/.page-header-->
    <!--PAGE CONTENT BEGINS-->
    <div class="row-fluid">
      <div class="span5">
        <div class="widget-box">
          <div class="widget-header widget-header-small header-color-grey ">
              <h4 class="smaller">
                <i class="icon-info-sign"></i>
                  Basic Information
              </h4>
          </div>
          <div class="widget-body">
              <div class="widget-main">
                  <form id='user_form'
                        class='form-horizontal'
                        role='form'
                        method="post"
                        action="{{ request.route_url('update_user', id=user.id) }}">


                      <div class="row-fluid">

                          <div class="span3">
                              <input id='thumbnail' name='thumbnail'
                                     type="file"/>
                          </div>

                          <div class="span2">
                              <div class="control-group">
                                  <label class="control-label"
                                         for="form-field-username">Username</label>

                                  <div class="controls">
                                      <input type="text"
                                             id="form-field-username"
                                             placeholder="Username"
                                             value='{{ user.login }}'/>
                                  </div>
                              </div>

                              <div class="control-group">
                                  <label class="control-label"
                                         for="form-field-first">Name</label>

                                  <div class="controls">
                                      <input type="text"
                                             id="form-field-first"
                                             placeholder="First Name"
                                             value='{{ user.name }}'/>
                                  </div>
                              </div>
                          </div>

                      </div>
                      <h4 class="header blue bolder smaller">Contact</h4>

                      <div class="row-fluid">
                          <div class="control-group">
                              <label class="control-label"
                                     for="form-field-email">Email</label>

                              <div class="controls">
                                  <span class="input-icon input-icon-right">
                                  <input type="email"
                                         id="form-field-email"
                                         value='{{ user.email }}'/>
                                  <i class="icon-envelope"></i>
                                  </span>
                              </div>
                          </div>


                          <div class="control-group">
                              <label class="control-label"
                                     for="form-field-phone">Phone</label>

                              <div class="controls">
          <span class="input-icon input-icon-right">
          <input class="input-mask-phone"
                 type="text"
                 id="form-field-phone"/>
          <i class="icon-phone icon-flip-horizontal"></i>
          </span>
                              </div>
                          </div>
                      </div>

                      <h4 class="header blue bolder smaller">Password</h4>

                      <div class="row-fluid">
                          {# Password #}
                          <div class="control-group">
                              <label for="user_password"
                                     class="span2 control-label">Password</label>

                              <div class="span6">
                                  <input id="user_password"
                                         name='password'
                                         type="password"
                                         class="form-control"
                                         placeholder="Password"
                                         required>
                              </div>
                          </div>

                          {# Confirm Password #}
                          <div class="control-group">
                              <label for="user_password2"
                                     class="span2 control-label">Confirm
                                  Password</label>

                              <div class="span6">
                                  <input id="user_password2"
                                         name='password2'
                                         type="password"
                                         class="form-control"
                                         placeholder="Confirm Password"
                                         required>
                              </div>
                          </div>

                      </div>


                      <div class="form-actions">
                          <button class="btn btn-info" type="button">
                              <i class="icon-ok bigger-110"></i>
                              Save
                          </button>

                          &nbsp; &nbsp; &nbsp;
                          <button class="btn" type="reset">
                              <i class="icon-undo bigger-110"></i>
                              Reset
                          </button>
                      </div>
                  </form>
              </div>
          </div>
      </div>
      </div>
      <div class="span7">
        <div class="row-fluid">
            <div class="hr hr6 hr-dotted"></div>
            <div class="space-16"></div>
            <div class="infobox-container">
                <div class="infobox infobox-purple  ">
                    <div class="infobox-icon">
                        <i class="icon-ticket"></i>
                    </div>

                    <div class="infobox-data">
                        <span class="infobox-data-number">{{ user.open_tickets | count }}</span>

                        <div class="infobox-content">open tickets</div>
                    </div>
                    <div class="badge badge-transparent">
                      <a href="#">Edit
                         <i class="icon-wrench red"></i>
                      </a>
                    </div>

                </div>

                <div class="infobox infobox-blue2  ">
                    <div class="infobox-icon">
                        <i class="icon-tasks"></i>
                    </div>


                    <div class="infobox-data">
                        <span class="infobox-data-number">{{ user.tasks | count }}</span>

                        <div class="infobox-content">tasks</div>
                    </div>
                    <div class="badge badge-transparent">
                      <a href="#">Edit
                         <i class="icon-wrench red"></i>
                      </a>
                    </div>
                </div>
                <div class="infobox infobox-orange">
                    <div class="infobox-icon">
                        <i class="icon-sun"></i>
                    </div>

                    <div class="infobox-data">
                        <span class="infobox-data-number">{{ user.vacations | count }}</span>

                        <div class="infobox-content">vacations</div>
                    </div>
                  <div class="badge badge-transparent">
                      <a href="#">Edit
                         <i class="icon-wrench red"></i>
                      </a>
                    </div>
                </div>


                <div class="hr hr32 hr-dotted"></div>


            </div>
        </div>
        <div class="row-fluid">
            <div class="span4">
                <div class="widget-box">
                    <div class="widget-header widget-header-small header-color-green">
                        <h4 class="smaller">
                            <i class="icon-folder-close-alt"></i>
                            Projects
                        </h4>

                        <div class="widget-toolbar action-buttons">
                            <a href="#" data-action="reload">
                                <i class="icon-refresh white"></i>
                            </a>

                            &nbsp;
                            <a href="#" class="white" data-rel="tooltip" title=""
                               data-original-title="Default">
                                <i class="icon-plus"></i>
                            </a>


                        </div>
                    </div>
                    <div class="widget-body">
                        <div class="widget-main">
                            {% if user.projects %}
                                {% for project in user.projects %}
                                    <div class="profile-activity clearfix">
                                        <div>
                                            <img class="pull-left"
                                                 src="{%- if project.thumbnail -%}
                                /{{ project.thumbnail.full_path }}
                            {%- else -%}
                                {{ request.static_url("stalker_pyramid:static/stalker/images/T_NO_IMAGE.gif") }}
                            {%- endif -%}">
                                            <a class="user"
                                               href="{{ request.route_url('view_project', id=project.id) }}">{{ project.name }} </a>

                                            <div class="time">
                                                <i class="icon-user bigger-110"></i>
                                                {{ project.users | count }} users
                                            </div>
                                        </div>

                                        <div class="tools action-buttons">
                                            <a href="#" class="blue">
                                                <i class="icon-pencil bigger-125"></i>
                                            </a>

                                            <a href="#" class="red">
                                                <i class="icon-remove bigger-125"></i>
                                            </a>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="profile-activity clearfix">
                                    No Project to list
                                </div>
                            {% endif %}


                        </div>
                    </div>
                </div>
                <div class="space-6"></div>
            </div>

            <div class="span4">
                <div class="widget-box">
                    <div class="widget-header widget-header-small header-color-blue">

                        <h4 class="smaller">
                            <i class="icon-key"></i>
                            Departments
                        </h4>

                        <div class="widget-toolbar action-buttons">
                            <a href="#" data-action="reload">
                                <i class="icon-refresh"></i>
                            </a>

                            &nbsp;
                            <a href="#" class="white">
                                <i class="icon-plus"></i>
                            </a>
                        </div>
                    </div>
                    <div class="widget-body">
                        <div class="widget-main">

                            {% for department in user.departments %}
                                <div class="profile-activity clearfix">
                                    <div>
                                        <img class="pull-left"
                                             src="{%- if department.thumbnail -%}
                                  /{{ department.thumbnail.full_path }}
                              {%- else -%}
                                  {{ request.static_url("stalker_pyramid:static/stalker/images/T_NO_IMAGE.gif") }}
                              {%- endif -%}">
                                        <a class="user"
                                           href="{{ request.route_url('view_entity_department', eid=user.id, id=department.id) }}">{{ department.name }}</a>

                                        <div class="time">
                                            <i class="icon-user bigger-110"></i>
                                            {{ department.users | count }} users
                                        </div>
                                    </div>

                                    <div class="tools action-buttons">
                                        <a href="#" class="blue">
                                            <i class="icon-pencil bigger-125"></i>
                                        </a>

                                        <a href="#" class="red">
                                            <i class="icon-remove bigger-125"></i>
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}


                        </div>
                    </div>
                </div>
                <div class="space-6"></div>
            </div>
            <div class="span4">
                <div class="widget-box">
                    <div class="widget-header widget-header-small header-color-purple">

                        <h4 class="smaller">
                            <i class="icon-group"></i>
                            Groups
                        </h4>

                        <div class="widget-toolbar action-buttons">
                            <a href="#" data-action="reload">
                                <i class="icon-refresh"></i>
                            </a>

                            &nbsp;
                            <a href="#" class="white">
                                <i class="icon-plus"></i>
                            </a>
                        </div>
                    </div>
                    <div class="widget-body">
                        <div class="widget-main">
                            {% for group in user.groups %}
                                <div class="profile-activity clearfix">
                                    <div>
                                        <img class="pull-left"
                                             src="{%- if group.thumbnail -%}
                                /{{ group.thumbnail.full_path }}
                            {%- else -%}
                                {{ request.static_url("stalker_pyramid:static/stalker/images/T_NO_IMAGE.gif") }}
                            {%- endif -%}">
                                        <a class="user"
                                           href="{{ request.route_url('view_entity_group', eid=user.id, id=group.id) }}">{{ group.name }}</a>

                                        <div class="time">
                                            <i class="icon-user bigger-110"></i>
                                            {{ group.users | count }} users
                                        </div>
                                    </div>

                                    <div class="tools action-buttons">
                                        <a href="#" class="blue">
                                            <i class="icon-pencil bigger-125"></i>
                                        </a>

                                        <a href="#" class="red">
                                            <i class="icon-remove bigger-125"></i>
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}


                        </div>
                    </div>
                </div>
                <div class="space-6"></div>
            </div>
        </div>
      </div>
    </div>
    <!--PAGE CONTENT ENDS-->

    <!--/.row-fluid-->

{% endblock page_content %}


{% block extrascripts %}
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery-ui-1.10.3.custom.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery.ui.touch-punch.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery.gritter.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/bootbox.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/chosen.jquery.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/date-time/bootstrap-datepicker.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/date-time/moment.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/date-time/daterangepicker.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/bootstrap-colorpicker.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery.autosize-min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery.inputlimiter.1.3.1.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery.maskedinput.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/bootstrap-tag.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery.validate.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/additional-methods.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/fuelux/fuelux.spinner.min.js") }}'></script>

    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/x-editable/bootstrap-editable.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/x-editable/ace-editable.min.js") }}'></script>



    <script type="text/javascript">

        {# Thumbnail #}
        $(document).ready(function () {
            $('#thumbnail').ace_file_input({
                style: 'well',
                btn_choose: 'Change Avatar',
                btn_change: null,
                no_icon: 'icon-picture',
                droppable: true,
                thumbnail: 'fit'
            });
        });

        {# Update Name and login #}
        {% if mode == 'update' %}
            $(document).ready(function () {
                $('#user_name').val('{{ user.name }}');
                $('#user_login').val('{{ user.login }}');
                $('#user_password').val('{{ user.password }}');
            });
        {% endif %}

        {# Chosen Field Updater #}
        var chosen_field_creator = function (field, url, data_template) {
            // fill image format with new json data
            return $.getJSON(url).then(function (data) {
                // remove current data
                field.empty();

                // append new options to the select
                for (var i = 0; i < data.length; i++) {
                    field.append(data_template(data[i]));
                }

                // convert it to chosen
                field.chosen();
            });
        };


        {# Form #}
        $(document).ready(function () {

            $('#user_form').validate({
                errorElement: 'span',
                errorClass: 'help-inline',
                focusInvalid: true,
                rules: {
                    email: {
                        required: true,
                        email: true
                    },
                    password: {
                        required: true,
                        minlength: 5
                    },
                    password2: {
                        required: true,
                        minlength: 5,
                        equalTo: "#user_password"
                    },
                    name: {
                        required: true
                    },
                    login: {
                        required: true
                    },
                    phone: {
                        required: true,
                        phone: 'required'
                    }
                },

                messages: {
                    email: {
                        required: "Please provide a valid email.",
                        email: "Please provide a valid email."
                    },
                    password: {
                        required: "Please specify a password.",
                        minlength: "Please specify a secure password."
                    },
                    subscription: "Please choose at least one option",
                    gender: "Please choose gender",
                    agree: "Please accept our policy"
                },

                invalidHandler: function (event, validator) { //display error alert on form submit
                    $('.alert-error', $('.login-form')).show();
                },

                highlight: function (e) {
                    $(e).closest('.control-group').removeClass('info').addClass('error');
                },

                success: function (e) {
                    $(e).closest('.control-group').removeClass('error').addClass('info');
                    $(e).remove();
                },

                errorPlacement: function (error, element) {
                    if (element.is(':checkbox') || element.is(':radio')) {
                        var controls = element.closest('.controls');
                        if (controls.find(':checkbox,:radio').length > 1) controls.append(error);
                        else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));
                    }
                    else if (element.is('.select2')) {
                        error.insertAfter(element.siblings('[class*="select2-container"]:eq(0)'));
                    }
                    else if (element.is('.chosen-select')) {
                        error.insertAfter(element.siblings('[class*="chosen-container"]:eq(0)'));
                    }
                    else error.insertAfter(element);
                },

                submitHandler: function (form) {
                    form.submit();
                },

                invalidHandler: function (form) {
                }
            });
        });

    </script>

{% endblock extrascripts %}