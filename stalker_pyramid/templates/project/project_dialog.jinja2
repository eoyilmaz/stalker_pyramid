{# Stalker Pyramid a Web Base Production Asset Management System
 Copyright (C) 2009-2013 Erkan Ozgur Yilmaz
 
 This file is part of Stalker Pyramid.
 
 This library is free software; you can redistribute it and/or
 modify it under the terms of the GNU Lesser General Public
 License as published by the Free Software Foundation;
 version 2.1 of the License.

 This library is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 Lesser General Public License for more details.

 You should have received a copy of the GNU Lesser General Public
 License along with this library; if not, write to the Free Software
 Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
#}
{% extends 'base.jinja2' %}

{% set project=entity %}


{% block pre_header %}
    <link rel="stylesheet" href='{{ request.static_url("stalker_pyramid:static/ace/css/chosen.min.css") }}' />
    <link rel="stylesheet" href='{{ request.static_url("stalker_pyramid:static/ace/css/datepicker.css") }}' />
    <link rel="stylesheet" href='{{ request.static_url("stalker_pyramid:static/ace/css/bootstrap-timepicker.css") }}' />
    <link rel="stylesheet" href='{{ request.static_url("stalker_pyramid:static/ace/css/daterangepicker.css") }}' />
    <link rel="stylesheet" href='{{ request.static_url("stalker_pyramid:static/ace/css/colorpicker.css") }}' />
{% endblock pre_header %}


{% block page_content %}

    {# Project Dialog #}
    <div class="page-header position-relative">
        <h1>{{ mode.title() }} Project</h1>
    </div>

    <div class='row-fluid'>
        <div class='span12'>
            <form class='form-horizontal' role='form'>

                {# Thumbnail #}
                <div class='control-group'>
                    <label for='thumbnail' class='span2 control-label'>Thumbnail</label>

                    <div class='span3'>
                        <input id='thumbnail' type="file">
                    </div>
                </div>
        
                {# Name #}
                <div class="control-group">
                    <label class="span2 control-label" for="project_name">Name</label>
                    <div class="span10">
                        <input type="text"
                               class="form-control"
                               id="project_name"
                               placeholder="Name">
                    </div>
                </div>
        
                {# Code #}
                <div class="control-group">
                    <label for="project_code" class="span2 control-label">Code</label>
                    <div class="span10">
                        <input id="project_code"
                               type="text"
                               class="form-control"
                               placeholder="Code">
                    </div>
                </div>
        
                {# Start & End Dates #}
                <div class="control-group">
                    <label for="start_end_date_range_picker" class="span2 control-label">Date</label>
                    <div class="span10 input-prepend">
                        <input id='start_end_date_range_picker'
                               type="text"
                               data-date-format="yyyy-mm-dd"
                               placeholder="Start & End Dates">
                        <span class="add-on">
                            <i class="icon-calendar"></i>
                        </span>
                    </div>
                </div>
        
                {# Image Format #}
                <div class="control-group">
                    <label for='image_format' class="span2 control-label">Image Format</label>
                    <div class="span10">
                        <select id='image_format' data-placeholder='Image Format'>
                            <option>Image Format 1</option>
                            <option>Image Format 2</option>
                            <option>Image Format 3</option>
                            <option>Image Format 4</option>
                            <option>Image Format 5</option>
                        </select>
                    </div>
                </div>
    
                {# FPS #}
                <div class='control-group'>
                    <label for='fps' class='span2 control-label'>FPS</label>
                    <div class='span10'>
                        <input id='fps' type='text' placeholder='FPS' value=25>
                    </div>
                </div>
    
                {# Repository #}
                <div class="control-group">
                    <label for='repository' class="span2 control-label">Repository</label>
                    <div class="span10">
                        <select id='repository' data-placeholder='Repository'>
                            <option>Repo 1</option>
                            <option>Repo 2</option>
                            <option>Repo 3</option>
                            <option>Repo 4</option>
                            <option>Repo 5</option>
                        </select>
                    </div>
                </div>
                
                {# Structure #}
                <div class="control-group">
                    <label for='structure' class="span2 control-label">Structure</label>
                    <div class="span10">
                        <select id='structure' data-placeholder='Structure'>
                            <option>Structure 1</option>
                            <option>Structure 2</option>
                            <option>Structure 3</option>
                            <option>Structure 4</option>
                            <option>Structure 5</option>
                        </select>
                    </div>
                </div>
                
                {# Lead #}
                <div class="control-group">
                    <label for='lead' class="span2 control-label">Lead</label>
                    <div class="span10">
                        <select id='lead' data-placeholder='Lead'>
                            <option>Lead 1</option>
                            <option>Lead 2</option>
                            <option>Lead 3</option>
                            <option>Lead 4</option>
                            <option>Lead 5</option>
                        </select>
                    </div>
                </div>
                
                {# Form Buttons #}
                <div class="form-actions">
                    <button type="button" class="btn btn-info btn-primary">
                        <i class="icon-ok"></i>
                        Ok
                    </button>
                    <button type="button" class="btn">
                        <i class="icon-remove"></i>
                        Cancel
                    </button>
                </div>
        
            </form>
        </div>
    </div>
    
{% endblock page_content %}




{#</div>#}
{% block extrascripts %}
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery-ui-1.10.3.custom.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery.ui.touch-punch.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/chosen.jquery.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/date-time/bootstrap-datepicker.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/date-time/moment.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/date-time/daterangepicker.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/bootstrap-colorpicker.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery.autosize-min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery.inputlimiter.1.3.1.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery.maskedinput.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/bootstrap-tag.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/jquery.validate.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/additional-methods.min.js") }}'></script>
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/fuelux/fuelux.spinner.min.js") }}'></script>




    <script type="text/javascript">



        {# Update info #}
        var name, code, start_date, end_date, image_format_id, fps=25,
                repository_id, structure_id, lead_id;
        console.debug('mode : ', '{{ mode }}');
        {% if mode == 'update' %}
            name = '{{ project.name }}';
            code = '{{ project.code }}';
            start_date = new Date({{ milliseconds_since_epoch(project.start) }});
            end_date = new Date({{ milliseconds_since_epoch(project.end) }});
            image_format_id = {{ project.image_format.id }};
            fps = {{ project.fps }}
            repository_id = {{ project.repository.id }};
            structure_id = {{ project.structure.id }};
            lead_id = {{ project.lead.id }};
        {% endif %}
        



        {# Update Name and code #}
        $(document).ready(function() {
            if (name) $('#project_name').val(name);
            if (code) $('#project_code').val(code);
        });




        {# Start & End Date Picker #}
        $(document).ready(function(){
            // initialize date picker
            var start_end_date_range_picker = $('#start_end_date_range_picker').daterangepicker();

            // also update the icon
            start_end_date_range_picker.next().on(ace.click_event, function () {
                $(this).prev().focus();
            });

            // fix z-index of the container
            start_end_date_range_picker.data().daterangepicker.container.css({'z-index': 1060});

            // fill data if mode is update
            if (start_date && end_date) {
                start_end_date_range_picker.val(
                    start_date.format('mm/dd/yyyy') + ' - ' + end_date.format('mm/dd/yyyy')
                );
                start_end_date_range_picker.data().daterangepicker.updateFromControl();
            }
        });



        {# FPS #}
        $(document).ready(function(){
            {# FPS Spinner #}
            $('#fps').ace_spinner({
                value: fps,
                min: 1,
                step: 1,
                btn_up_class: 'btn-info',
                btn_down_class: 'btn-info'
            }).on('change', function () {
                //alert(this.value)
            });
        });






        {# Chosen Field Updater #}
        var chosen_field_creator = function(selector, url, data_template){
            var field = $(selector);

            // fill image format with new json data
            return $.getJSON(url).then(function(data){
                // remove current data
                field.empty();

                // append new options to the select
                for (var i=0; i<data.length; i++) {
                    field.append( data_template(data[i]) );
                }

                // convert it to chosen
                field.chosen();
            });
        };




        {# Image Format #}
        $(document).ready(function(){
            {% raw %}
            var image_format_option_template = doT.template(
                '<option value={{=it.id}}>{{=it.name}} ({{=it.width}} x {{=it.height}} x {{=it.pixel_aspect}})</option>'
            );
            {% endraw %}
            var deferred = chosen_field_creator('#image_format', '/image_formats/', image_format_option_template);
            if (image_format_id){
                deferred.then(function(){
                    $('#image_format').val(image_format_id).trigger('chosen:updated');
                });
            }
        });




        {# Repository #}
        $(document).ready(function(){
            {% raw %}
            var repository_option_template = doT.template(
                '<option value={{=it.id}}>{{=it.name}}</option>'
            );
            {% endraw %}
            var deferred = chosen_field_creator('#repository', '/repositories/', repository_option_template);
            if (repository_id){
                deferred.then(function(){
                    $('#repository').val(repository_id).trigger('chosen:updated');
                });
            }
        });




        {# Structure #}
        $(document).ready(function(){
            {% raw %}
            var structure_option_template = doT.template(
                '<option value={{=it.id}}>{{=it.name}}</option>'
            );
            {% endraw %}
            var deferred = chosen_field_creator('#structure', '/structures/', structure_option_template);
            if (structure_id){
                deferred.then(function(){
                    $('#structure').val(structure_id).trigger('chosen:updated');
                });
            }
        });




        {# Lead #}
        $(document).ready(function(){
            {% raw %}
            var lead_option_template = doT.template(
                '<option value={{=it.id}}>{{=it.name}}</option>'
            );
            {% endraw %}
            var deferred = chosen_field_creator('#lead', '/users/?simple=true', lead_option_template);
            if (lead_id){
                deferred.then(function(){
                    $('#lead').val(lead_id).trigger('chosen:updated');
                });
            }
        });




        {# Thumbnail #}
        $(document).ready(function($){
            $('#thumbnail').ace_file_input({
                style: 'well',
                btn_choose: 'Drop files here or click to choose',
                btn_change: null,
                no_icon: 'icon-cloud-upload',
                droppable: true,
                thumbnail: 'fit'
            });
        });

    </script>

{% endblock extrascripts %}
