<div id="version_message" class="alert alert-info bigger-110">
</div>

{% raw %}
    <script id="tmpl_messageVersion" type="text/x-dot-template">
        {{ if (it.file_name != '') { }}
        <div class="row-fluid">
            <h4 class="green">{{=it.title }}</h4>
            <dl id="dt-list-1" class="dl-horizontal pull-left grey">
                <dt>Task:</dt>
                <dd>
                     <a href="/tasks/{{=it.task_id }}/view" target="_blank">{{=it.task_name }}</a>
                </dd>
                <dt>Absolute Path :</dt>
                <dd>
                    <a href="javascript:copyToClipboard('{{=it.path }}')">{{=it.file_name }}</a>
                </dd>
                <dt>Date :</dt>
                <dd> {{=it.date }} (<span class="date">{{=it.date }}</span>)
                </dd>
                <dt>Created by :</dt>
                <dd>
                    <a href="/users/{{=it.created_by_id }}/view" target="_blank">{{=it.created_by_name }}</a>
                </dd>
                <dt>Description :</dt>
                <dd> {{=it.description }}</dd>
            </dl>
        </div>
        {{ } }}

        <div class="row-fluid">
            This will send a <strong>review request</strong> to the
        responsible of this task and you will <strong>not</strong>
        be able to <strong>create any TimeLogs</strong> for this
        task after this point<br><br><strong>Are you sure?</strong>
        </div>
        </script>
{% endraw %}


<script>
    function init_dialog() {
        console.debug('starting to initialize confirm dialog!!!');

        var dialog_template_label = $('#dialog_template_label');
        dialog_template_label.find('span').remove();
        dialog_template_label.append('<span class="red"><i class="icon-warning-sign"></i> Warning</span>');


        var url = '{{ action }}'

        {% if version != None %}



            var message_template = doT.template($('#tmpl_messageVersion').html());

            $('#version_message').append(message_template(
                    {
                          title: 'Last version of this task',
                          path:'{{ version.path }}',
                          task_id:'{{ version.task_id }}',
                          task_name:'{{ version.task_name }}',
                          date: '{{ version.date_updated }}',
                          created_by_id:'{{ version.created_by_id }}',
                          created_by_name:'{{ version.created_by_name }}',
                          description:'{{ version.description }}',
                          file_name:'{{ version.file_name }}'
                    }

            ));

        {% else %}

            $('#version_message').append("<strong>{{ task_type }}</strong> type task needs to a published version to review. There is no published version of this task. This task's last version must be published!");

        {% endif %}



        {# ***************************************************************** #}
        {# Submit Button #}
        $('#dialog_template_submit_button').on('click', function (e) {
            e.stopPropagation();
            e.preventDefault();

            // disable the submit_button
            var submit_button = $(this);

            if (url)  {
                submit_button.button('loading');

                $.post(url).done(function (response) {
                    $('#dialog_template').modal('hide');
                    // reload page
                    setTimeout(function () { // wait for hide event to finish
                        window.location.reload();
                    }, 0);
                }).fail(function (jqXHR) {
                            bootbox.alert('<h6 class="red"><i class="icon-warning-sign"></i> Failed</h6>' + jqXHR.responseText);
                            submit_button.button('reset');
                        });
            }
            else  {
                $('#dialog_template').modal('hide');
            }
        });


        $('.date').each(function () {
            var date = moment.utc($(this).text());
            $(this).text(date.fromNow());
        });


        console.debug('finished initializing the confirm dialog!')
    }
</script>


<script type="text/javascript">
    function destruct_dialog() {


        $('#dialog_template_submit_button').unbind();

        $('#dialog_template').data('modal', null);

    }
</script>
