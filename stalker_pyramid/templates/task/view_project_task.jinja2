{% extends "base.jinja2" %}

{#PRE-HEADER #}
{% block pre_header %}

    {% include 'task/list_tasks_preheader.jinja2' %}

    <link rel="stylesheet" href='request.static_url("stalker_pyramid:static/ace/css/dropzone.css")' />

{% endblock pre_header %}

{#SIDEBAR#}
{% block sidebar %}

    {% include 'sidebar.jinja2' %}

{% endblock sidebar %}

{#BREADCRUMBS#}
{% block breadcrumbs %}

    {% set listed_type=task.plural_class_name %}
    {% set page_title=task.name %}
    {% include 'breadcrumbs_detail.jinja2' %}

{% endblock breadcrumbs %}


{#PAGE-CONTENT#}
{% block page_content %}
    <div class="row-fluid">

        <div class="media">
            <a class="pull-left" href="#"
               style="width: 150px; height: 150px">
                <img style='width:auto; height: auto;'
                     class="img-thumbnail"
                     src="{%- if task.thumbnail -%}
                    /{{ task.thumbnail.full_path }}
                {%- else -%}
                    {{ request.static_url("stalker_pyramid:static/stalker/images/T_NO_IMAGE.gif") }}
                {%- endif -%}">
            </a>

            <div class="media-body">
                <div class="span12">
                    <div class="widget-box transparent invoice-box">
                        <div class="widget-header widget-header-small">
                            <h3 class="pull-left position-relative">
                                {{ task.name }}
                              <i class="icon-double-angle-right"></i>
                              <small class="green">{{ task.type.name }}</small>
                            </h3>

                            <div class="widget-toolbar no-border invoice-info">
                                <span class="invoice-info-label">{{ task.status.name }}</span>
                            </div>

                            <div class="widget-toolbar hidden-480">
                                <a href="#">
                                    <i class="icon-info"></i>
                                </a>
                            </div>
                        </div>

                        <div class="widget-body">
                            <div class="widget-main padding-10">
                                <div class="row-fluid">
                                    <div class="span3">
                                        <ul class="unstyled spaced">
                                            <li>
                                                {{ task.start }} <i
                                                    class="icon-long-arrow-right blue"></i> {{ task.end }}
                                            </li>

                                            <li>

                                                <b>Created By
                                                    : </b> {{ task.created_by.name }}
                                            </li>
                                            <li>
                                                <b>Updated By
                                                    : </b> {{ task.updated_by.name }}
                                            </li>
                                        </ul>
                                         <button class='btn btn-mini btn-info'><i class="icon-edit"></i> Edit
                </button>
                                    </div>
                                  {% if task.description %}
                                    <div class="span6">

                                        <div class="well">
                                          <h5 class="header smaller lighter grey">Description</h5>
                                            {{ task.description }}
                                        </div>
                                    </div>
                                  {% endif %}
                                </div>

                                <!--/span-->

                            </div>


                            <!--row-->


                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
    <div class="row-fluid">
        <div class="span12">
            <div class="tabbable">
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a href="#task_dashboard" data-toggle="tab">
                            <i class="icon-dashboard"></i> Dashboard
                        </a>
                    </li>
                    <li class="">
                        <a href="#task_tasks" data-toggle="tab">
                            <i class="icon-tasks"></i> Tasks
                        </a>
                    </li>
                    <li class="">
                        <a href="#task_versions" data-toggle="tab">
                            <i class="icon-archive"></i> Versions
                        </a>
                    </li>
                    <li class="">
                        <a href="#task_references" data-toggle="tab">
                            <i class="icon-picture"></i> References
                        </a>
                    </li>
                </ul>


                <div id="myTabContent" class="tab-content">
                    <div class="tab-pane fade active in" id="task_dashboard">
                        task_dashboard
                    </div>
                    <div class="tab-pane fade" id="task_tasks">
                        {% include 'task/list_tasks.jinja2' %}
                    </div>
                    <div class="tab-pane fade" id="task_versions">
                        {% set versions=task.versions %}
                        {% include 'version/list_entity_versions.jinja2' %}
                    </div>
                    <div class="tab-pane fade" id="task_references">
                        {% set references=task.references %}
                        {% include 'link/list_entity_references.jinja2' %}
                    </div>

                </div>
            </div>
        </div>
    </div>

{% endblock page_content %}

{#EXTRA-SCRIPTS#}
{% block extrascripts %}
    <script src='{{ request.static_url("stalker_pyramid:static/ace/js/dropzone.min.js") }}'></script>
    <!--inline scripts related to this page-->

    <script type="text/javascript">
        jQuery(function ($) {

            try {
                $(".dropzone").dropzone({
                    paramName: "file", // The name that will be used to transfer the file
                    maxFilesize: 0.5, // MB

                    addRemoveLinks: true,
                    dictDefaultMessage: '<span class="bigger-150 bolder"><i class="icon-caret-right red"></i> Drop files</span> to upload \
<span class="smaller-80 grey">(or click)</span> <br /> \
<i class="upload-icon icon-cloud-upload blue icon-3x"></i>',
                    dictResponseError: 'Error while uploading file!',

//change the previewTemplate to use Bootstrap progress bars
                    previewTemplate: "<div class=\"dz-preview dz-file-preview\">\n  <div class=\"dz-details\">\n    <div class=\"dz-filename\"><span data-dz-name></span></div>\n    <div class=\"dz-size\" data-dz-size></div>\n    <img data-dz-thumbnail />\n  </div>\n  <div class=\"progress progress-small progress-success progress-striped active\"><span class=\"bar\" data-dz-uploadprogress></span></div>\n  <div class=\"dz-success-mark\"><span></span></div>\n  <div class=\"dz-error-mark\"><span></span></div>\n  <div class=\"dz-error-message\"><span data-dz-errormessage></span></div>\n</div>"
                });
            } catch (e) {
                alert('Dropzone.js does not support older browsers!');
            }

        });
    </script>
{% endblock extrascripts %}