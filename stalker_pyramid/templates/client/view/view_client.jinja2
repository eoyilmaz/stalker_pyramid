{# Stalker Pyramid a Web Base Production Asset Management System
 Copyright (C) 2009-2014 Erkan Ozgur Yilmaz

 This file is part of Stalker Pyramid.

 This library is free software; you can redistribute it and/or
 modify it under the terms of the GNU Lesser General Public
 License as published by the Free Software Foundation;
 version 2.1 of the License.

 This library is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 Lesser General Public License for more details.

 You should have received a copy of the GNU Lesser General Public
 License along with this library; if not, write to the Free Software
 Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
#}

{% extends "base.jinja2" %}

{# BREADCRUMBS #}
{% block breadcrumbs %}

    {% set page_title='clients' %}
    {% include 'breadcrumb/breadcrumbs.jinja2' %}

{% endblock breadcrumbs %}

{# SIDEBAR #}
{% block sidebar %}

    {% include 'sidebar.jinja2' %}

{% endblock sidebar %}

{# PAGE-CONTENT #}
{% block page_content %}
    {% set page_title='Projects' %}
    {% include 'page_header.jinja2' %}
    <div id="pictures" class="tab-pane">
        <ul id='client_projects' class="ace-thumbnails">

        </ul>
    </div>
{% endblock page_content %}

{# EXTRA-SCRIPTS #}
{% block extrascripts %}
{% raw %}
<script id="tmpl_project_card" type="text/x-dot-template">
    <li>
        <a href="/projects/{{=it.id }}/view" data-rel="colorbox">
            <img alt="150x150"
                 style="height: 150px; width: auto;"
                 src="{{=it.thumbnail_full_path }}" />
            <div class="text">
                <div class="inner">{{=it.name }}</div>
            </div>
        </a>

        <div class="tools tools-bottom">
            <a href="#">
                <i class="icon-link"></i>
            </a>

            <a href="#">
                <i class="icon-paper-clip"></i>
            </a>

            <a href="#">
                <i class="icon-pencil"></i>
            </a>

            <a href="#">
                <i class="icon-remove red"></i>
            </a>
        </div>
    </li>
 </script>
{% endraw %}
<script type="text/javascript">
    $(function () {

        $.getJSON('/entities/{{ entity.id }}/projects/').then(function (data) {

            var project_card_template = doT.template($('#tmpl_project_card').html());
            var client_projects = $('#client_projects');

            console.log(data.length);

            for(var i=0; i<data.length;i++){

                if (data[i].thumbnail_full_path == null) {
                    data[i].thumbnail_full_path = '{{ request.static_url("stalker_pyramid:static/stalker/images/T_NO_IMAGE.gif") }}';
                }
                else {
                    data[i].thumbnail_full_path = '/' + data[i].thumbnail_full_path;
                }

                client_projects.append(project_card_template(data[i]));

            }


        })


    })
</script>
{% endblock extrascripts %}